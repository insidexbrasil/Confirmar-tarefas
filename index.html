<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Confirmar Tarefa</title>
  <style>
    body {
      background-color: #111;
      color: #fff;
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }

    .card {
      background-color: #1a1a1a;
      padding: 30px;
      border-radius: 16px;
      text-align: center;
      box-shadow: 0 0 25px rgba(0, 255, 183, 0.2);
    }

    .botao-confirmar {
      background-color: #00ffb7;
      color: #000;
      font-weight: bold;
      padding: 12px 24px;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 20px;
      transition: background 0.3s;
    }

    .botao-confirmar:disabled {
      background-color: #555;
      cursor: not-allowed;
    }

    h1 {
      font-size: 24px;
      color: #00ffb7;
    }

    p {
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>Confirmar Tarefa</h1>
    <p>Clique abaixo para confirmar a tarefa e atualizar seu saldo.</p>
    <button id="btnConfirmar" class="botao-confirmar">Confirmar Tarefa</button>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc, arrayUnion, increment } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBxtvz8KqN5knzovcYRHdXxMtcUDhDYI1g",
      authDomain: "insidexbr.firebaseapp.com",
      projectId: "insidexbr",
      storageBucket: "insidexbr.firebasestorage.app",
      messagingSenderId: "166788819502",
      appId: "1:166788819502:web:b9d4135d4693a2f5eb8dbf"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const btn = document.getElementById("btnConfirmar");
    const valorTarefa = 0.04;

    signInAnonymously(auth)
      .then(() => {
        onAuthStateChanged(auth, async (user) => {
          if (user) {
            const uid = user.uid;
            const userRef = doc(db, "usuarios", uid);
            const userSnap = await getDoc(userRef);

            if (!userSnap.exists()) {
              await setDoc(userRef, {
                saldo: 0,
                historico: [],
                grafico: []
              });
            }

            btn.addEventListener("click", async () => {
              // Atualiza dados no Firestore
              await updateDoc(userRef, {
                saldo: increment(valorTarefa),
                historico: arrayUnion(`Tarefa confirmada em ${new Date().toLocaleString()}`),
                grafico: arrayUnion(1)
              });

              btn.textContent = "Tarefa Confirmada!";
              btn.disabled = true;

              setTimeout(() => {
                window.location.href = "https://insidexbrasil.github.io/Insidex/";
              }, 3000);
            });
          }
        });
      })
      .catch((error) => {
        console.error("Erro ao logar anonimamente:", error);
      });
  </script>
</body>
</html>
